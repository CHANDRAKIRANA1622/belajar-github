<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StaffCheck Pro | Advanced Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* VARIABLES - PROTEGEL THEME */
        :root {
            --protogel-primary: #ff6b00;
            --protogel-secondary: #00a8ff;
            --protogel-dark: #0a1931;
            --protogel-light: #f8f9fa;
            --protogel-accent: #ffd32a;
            --protogel-gradient: linear-gradient(135deg, #ff6b00 0%, #00a8ff 100%);
            --protogel-gradient-dark: linear-gradient(135deg, #0a1931 0%, #162447 100%);
            --protogel-gradient-card: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
            --protogel-neon: 0 0 20px rgba(255, 107, 0, 0.5);
            --border-radius: 16px;
            --border-radius-sm: 10px;
            --box-shadow: 0 10px 40px rgba(255, 107, 0, 0.1);
            --box-shadow-lg: 0 20px 60px rgba(255, 107, 0, 0.2);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--protogel-dark);
            color: var(--protogel-light);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 0, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 168, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 211, 42, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        /* SCROLLBAR STYLING */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--protogel-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--protogel-gradient);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--protogel-primary);
        }

        /* LAYOUT */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 25px;
        }

        /* HEADER */
        .main-header {
            background: rgba(10, 25, 49, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid var(--protogel-primary);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* LOGO */
        .protogel-logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-container {
            position: relative;
            width: 70px;
            height: 70px;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .logo-circle {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--protogel-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--protogel-neon);
            overflow: hidden;
        }

        .logo-circle::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(from 0deg, 
                var(--protogel-primary) 0deg, 
                var(--protogel-accent) 90deg, 
                var(--protogel-secondary) 180deg, 
                var(--protogel-primary) 270deg, 
                var(--protogel-primary) 360deg);
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .logo-inner {
            position: relative;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: var(--protogel-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 900;
            background: var(--protogel-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .logo-subtitle {
            display: block;
            font-size: 12px;
            font-weight: 400;
            color: var(--protogel-accent);
            letter-spacing: 4px;
            margin-top: 5px;
        }

        .datetime-container {
            background: rgba(255, 107, 0, 0.1);
            border: 1px solid rgba(255, 107, 0, 0.3);
            padding: 15px 30px;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        #currentDateTime {
            font-weight: 600;
            font-size: 16px;
            background: linear-gradient(to right, var(--protogel-primary), var(--protogel-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* DATA SAVED INDICATOR */
        .data-saved {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 168, 255, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: var(--border-radius-sm);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 168, 255, 0.3);
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }

        .data-saved.show {
            transform: translateY(0);
        }

        /* RESET OPTION STYLES */
        .reset-option {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(255, 107, 0, 0.2);
            border-radius: var(--border-radius-sm);
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
        }

        .reset-option:hover {
            background: rgba(255, 107, 0, 0.1);
            border-color: var(--protogel-primary);
            transform: translateY(-3px);
        }

        .reset-option.selected {
            background: rgba(255, 107, 0, 0.15);
            border-color: var(--protogel-primary);
            box-shadow: 0 5px 20px rgba(255, 107, 0, 0.2);
        }

        /* MAIN CONTENT */
        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        /* SIDEBAR */
        .sidebar {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 107, 0, 0.2);
            padding: 25px;
            box-shadow: var(--box-shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
            animation: slideInLeft 0.8s ease-out;
        }

        @keyframes slideInLeft {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .user-profile {
            text-align: center;
            padding-bottom: 25px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 107, 0, 0.2);
        }

        .avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--protogel-gradient);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            border: 3px solid var(--protogel-primary);
            box-shadow: 0 0 30px rgba(255, 107, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .avatar::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .user-name {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 18px;
            color: var(--protogel-light);
        }

        .user-role {
            color: var(--protogel-primary);
            font-size: 14px;
            background: rgba(255, 107, 0, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 12px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 20px;
            border-radius: var(--border-radius-sm);
            color: var(--protogel-light);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            left: -100%;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 0, 0.2), transparent);
            transition: 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover {
            background: rgba(255, 107, 0, 0.1);
            transform: translateX(10px);
            border-left: 3px solid var(--protogel-primary);
        }

        .nav-link.active {
            background: rgba(255, 107, 0, 0.15);
            color: var(--protogel-primary);
            border-left: 3px solid var(--protogel-primary);
            box-shadow: 0 5px 20px rgba(255, 107, 0, 0.2);
        }

        .nav-link i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .badge {
            margin-left: auto;
            background: var(--protogel-gradient);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* CONTENT AREA */
        .content-area {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 107, 0, 0.2);
            padding: 35px;
            box-shadow: var(--box-shadow-lg);
            min-height: 600px;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 107, 0, 0.2);
        }

        .page-title {
            font-size: 32px;
            font-weight: 800;
            background: var(--protogel-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-title i {
            font-size: 36px;
        }

        /* BANNER */
        .protogel-banner {
            background: var(--protogel-gradient-dark);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 107, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .banner-content {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .banner-logo {
            width: 120px;
            height: 120px;
            flex-shrink: 0;
        }

        .banner-logo-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--protogel-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 50px rgba(255, 107, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .banner-logo-circle::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(from 0deg, 
                var(--protogel-primary) 0deg, 
                var(--protogel-accent) 90deg, 
                var(--protogel-secondary) 180deg, 
                var(--protogel-primary) 270deg, 
                var(--protogel-primary) 360deg);
            animation: rotate 4s linear infinite;
        }

        .banner-logo-inner {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--protogel-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .banner-logo-text {
            font-size: 36px;
            font-weight: 900;
            background: var(--protogel-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 3px;
        }

        .banner-text h2 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--protogel-light);
        }

        .banner-text p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            line-height: 1.6;
        }

        /* STATS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: var(--protogel-gradient-card);
            border-radius: var(--border-radius);
            padding: 30px;
            border: 1px solid rgba(255, 107, 0, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--protogel-gradient);
        }

        .stat-card:hover {
            transform: translateY(-10px);
            border-color: var(--protogel-primary);
            box-shadow: var(--box-shadow-lg);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 25px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .stat-icon.total { background: var(--protogel-gradient); }
        .stat-icon.checked { background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%); }
        .stat-icon.pending { background: linear-gradient(135deg, #ff6b00 0%, #ffd32a 100%); }
        .stat-icon.absent { background: linear-gradient(135deg, #ff0055 0%, #ff5500 100%); }
        .stat-icon.shift { background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%); }

        .stat-icon::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(45deg);
        }

        .stat-content h3 {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 15px;
            background: var(--protogel-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-trend {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #00ff88;
        }

        .trend-up { color: #00ff88; }
        .trend-down { color: #ff0055; }

        /* SHIFT BADGES */
        .shift-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .shift-pagi {
            background: rgba(255, 211, 42, 0.15);
            color: #ffd32a;
            border: 1px solid rgba(255, 211, 42, 0.3);
        }

        .shift-siang {
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .shift-sore {
            background: rgba(255, 107, 0, 0.15);
            color: #ff6b00;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .shift-malam {
            background: rgba(102, 126, 234, 0.15);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .shift-cuti {
            background: rgba(160, 160, 160, 0.15);
            color: #a0a0a0;
            border: 1px solid rgba(160, 160, 160, 0.3);
        }

        /* SHIFT CARDS */
        .shift-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .shift-card-item {
            background: var(--protogel-gradient-card);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid rgba(255, 107, 0, 0.2);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .shift-card-item:hover {
            transform: translateY(-5px);
            border-color: var(--protogel-primary);
            box-shadow: var(--box-shadow);
        }

        .shift-card-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }

        .shift-card-item.pagi::before { background: #ffd32a; }
        .shift-card-item.siang::before { background: #00ff88; }
        .shift-card-item.sore::before { background: #ff6b00; }
        .shift-card-item.malam::before { background: #667eea; }
        .shift-card-item.cuti::before { background: #a0a0a0; }

        .shift-staff-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--protogel-light);
        }

        .shift-time {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }

        .shift-category {
            display: inline-block;
            margin-top: 10px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .shift-category.senior { background: rgba(255, 107, 0, 0.2); color: #ff6b00; }
        .shift-category.training { background: rgba(0, 168, 255, 0.2); color: #00a8ff; }
        .shift-category.kapten { background: rgba(255, 211, 42, 0.2); color: #ffd32a; }

        /* FILTER SECTION */
        .filter-section {
            background: rgba(255, 107, 0, 0.05);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 107, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 18px;
        }

        .search-box input {
            width: 100%;
            padding: 16px 20px 16px 55px;
            border: 2px solid transparent;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            transition: var(--transition);
            background: rgba(10, 25, 49, 0.8);
            color: white;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--protogel-primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.2);
        }

        .search-box input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .filter-select {
            padding: 16px 25px;
            border: 2px solid transparent;
            border-radius: var(--border-radius-sm);
            font-size: 15px;
            background: rgba(10, 25, 49, 0.8);
            color: white;
            cursor: pointer;
            transition: var(--transition);
            min-width: 200px;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--protogel-primary);
        }

        .action-button {
            padding: 16px 30px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--protogel-gradient);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .action-button:hover::before {
            left: 100%;
        }

        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 107, 0, 0.4);
        }

        .action-button.success {
            background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
        }

        .action-button.danger {
            background: linear-gradient(135deg, #ff0055 0%, #ff5500 100%);
        }

        .action-button.shift {
            background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%);
        }

        /* TABLE CONTAINER */
        .table-container {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            margin-top: 40px;
            overflow-x: auto;
            border: 1px solid rgba(255, 107, 0, 0.2);
        }

        .table-header {
            background: var(--protogel-gradient-dark);
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 107, 0, 0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        thead {
            background: linear-gradient(90deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
        }

        th {
            padding: 22px 25px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--protogel-primary);
            border-bottom: 2px solid var(--protogel-primary);
        }

        td {
            padding: 22px 25px;
            border-bottom: 1px solid rgba(255, 107, 0, 0.1);
            font-size: 15px;
        }

        tbody tr {
            transition: var(--transition);
        }

        tbody tr:hover {
            background: rgba(255, 107, 0, 0.05);
        }

        /* BADGES */
        .status-badge {
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        .status-checked {
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .status-pending {
            background: rgba(255, 107, 0, 0.15);
            color: #ff6b00;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .status-absent {
            background: rgba(255, 0, 85, 0.15);
            color: #ff5588;
            border: 1px solid rgba(255, 0, 85, 0.3);
        }

        .role-badge {
            padding: 6px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .role-cs {
            background: rgba(255, 107, 0, 0.15);
            color: var(--protogel-primary);
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .role-kapten {
            background: rgba(0, 168, 255, 0.15);
            color: var(--protogel-secondary);
            border: 1px solid rgba(0, 168, 255, 0.3);
        }

        .role-kasir {
            background: rgba(255, 211, 42, 0.15);
            color: var(--protogel-accent);
            border: 1px solid rgba(255, 211, 42, 0.3);
        }

        /* ACTION BUTTONS */
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-icon:hover {
            transform: translateY(-3px) scale(1.1);
        }

        .btn-checkin:hover {
            background: #00ff88;
            color: white;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }

        .btn-edit:hover {
            background: var(--protogel-primary);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 107, 0, 0.4);
        }

        .btn-delete:hover {
            background: #ff0055;
            color: white;
            box-shadow: 0 5px 20px rgba(255, 0, 85, 0.4);
        }

        .btn-shift:hover {
            background: #9d4edd;
            color: white;
            box-shadow: 0 5px 20px rgba(157, 78, 221, 0.4);
        }

        /* MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 25, 49, 0.95);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--protogel-gradient-card);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 107, 0, 0.3);
            width: 100%;
            max-width: 600px;
            box-shadow: var(--box-shadow-lg);
            overflow: hidden;
            transform: translateY(0);
            animation: modalSlideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes modalSlideUp {
            from { 
                transform: translateY(50px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }

        .modal-header {
            background: var(--protogel-gradient-dark);
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 107, 0, 0.2);
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--protogel-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 28px;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--protogel-primary);
            background: rgba(255, 107, 0, 0.1);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            color: var(--protogel-light);
            font-weight: 500;
            font-size: 15px;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid transparent;
            border-radius: var(--border-radius-sm);
            font-size: 15px;
            transition: var(--transition);
            background: rgba(10, 25, 49, 0.8);
            color: white;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--protogel-primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.2);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* FORM CARD */
        .form-card {
            background: rgba(26, 26, 46, 0.8);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 107, 0, 0.2);
            padding: 30px;
            box-shadow: var(--box-shadow);
        }

        body.modal-open {
            overflow: hidden;
        }

        /* SHIFT MODAL SPECIFIC */
        .shift-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .shift-option {
            background: rgba(10, 25, 49, 0.8);
            border: 1px solid rgba(255, 107, 0, 0.3);
            border-radius: var(--border-radius-sm);
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
        }

        .shift-option:hover {
            background: rgba(255, 107, 0, 0.1);
            border-color: var(--protogel-primary);
            transform: translateY(-3px);
        }

        .shift-option.selected {
            background: rgba(255, 107, 0, 0.15);
            border-color: var(--protogel-primary);
            box-shadow: 0 5px 20px rgba(255, 107, 0, 0.2);
        }

        .shift-option-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--protogel-light);
        }

        .shift-option-time {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }

        .shift-option-category {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        /* ENHANCED FEATURES STYLES */
        .bulk-select-header {
            text-align: center !important;
            width: 50px !important;
        }

        .bulk-select-all {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .notification-warning {
            background: rgba(255, 193, 7, 0.9) !important;
            border: 1px solid rgba(255, 193, 7, 0.3) !important;
        }

        .stat-value.animating {
            animation: pulse 0.5s ease-in-out;
        }

        .action-button.print {
            background: linear-gradient(135deg, #6f42c1 0%, #9b4dca 100%);
        }

        .action-button.filtered {
            background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);
        }

        .offline-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 193, 7, 0.9);
            color: #333;
            padding: 10px 20px;
            border-radius: var(--border-radius-sm);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
            animation: slideInLeft 0.3s ease;
        }

        .online-indicator {
            background: rgba(0, 255, 136, 0.9);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--protogel-primary);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .table-container {
            position: relative;
        }

        .table-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                margin-bottom: 30px;
            }
        }

        @media (max-width: 992px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .datetime-container {
                width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .page-title {
                font-size: 28px;
            }
            
            .banner-content {
                flex-direction: column;
                text-align: center;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .content-area {
                padding: 25px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box, .filter-select {
                min-width: 100%;
            }
            
            .table-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .action-button {
                width: 100%;
                justify-content: center;
            }
            
            .modal-content {
                margin: 10px;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .modal-header {
                padding: 20px;
            }
            
            .modal-title {
                font-size: 20px;
            }
        }

        @media (max-width: 576px) {
            .page-header {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }
            
            th, td {
                padding: 15px;
            }
            
            .banner-logo {
                width: 80px;
                height: 80px;
            }
            
            .banner-logo-circle {
                width: 80px;
                height: 80px;
            }
            
            .banner-logo-inner {
                width: 60px;
                height: 60px;
            }
            
            .banner-logo-text {
                font-size: 24px;
            }
            
            #addPage {
                grid-template-columns: 1fr !important;
            }
            
            .form-card {
                padding: 20px;
            }
            
            .shift-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="protogel-logo">
                    <div class="logo-container">
                        <div class="logo-circle">
                            <div class="logo-inner">
                                <div class="logo-text">P</div>
                            </div>
                        </div>
                    </div>
                    <div class="logo-text">
                        PROTEGEL
                        <span class="logo-subtitle">STAFF SYSTEM</span>
                    </div>
                </div>
                <div class="datetime-container">
                    <div id="currentDateTime">Selasa, 30 Desember 2025 | 03:00:40</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="user-profile">
                    <div class="avatar">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h3 class="user-name">ADMIN CHANDRA KIRANA</h3>
                    <span class="user-role">System Manager</span>
                </div>
                
                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-page="dashboard">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-page="checkin">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Check-in Staff</span>
                                <span class="badge" id="pendingBadge">59</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-page="manage">
                                <i class="fas fa-users-cog"></i>
                                <span>Kelola Staff</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-page="shift">
                                <i class="fas fa-clock"></i>
                                <span>Shift Management</span>
                                <span class="badge">NEW</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-page="add">
                                <i class="fas fa-user-plus"></i>
                                <span>Tambah Staff</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-page="reports">
                                <i class="fas fa-chart-bar"></i>
                                <span>Analytics</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-page="settings">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="content-area" id="contentArea">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content">
                    <div class="page-header">
                        <h2 class="page-title"><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-button danger" id="resetAllBtn" style="background: linear-gradient(135deg, #ff0055 0%, #ff5500 100%);">
                                <i class="fas fa-redo"></i> Reset All
                            </button>
                            <button class="action-button" id="refreshDashboard">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="action-button print" id="printReportBtn">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>

                    <!-- Protogel Banner -->
                    <div class="protogel-banner">
                        <div class="banner-content">
                            <div class="banner-logo">
                                <div class="banner-logo-circle">
                                    <div class="banner-logo-inner">
                                        <div class="banner-logo-text">P</div>
                                    </div>
                                </div>
                            </div>
                            <div class="banner-text">
                                <h2>PROTEGEL STAFF MANAGEMENT</h2>
                                <p>Sistem manajemen staff dengan <strong>Local Storage</strong> - data tersimpan otomatis di browser Anda. Check-in staff akan tetap tersimpan meski halaman direfresh atau browser ditutup.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon total">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Total Staff</h3>
                                <div class="stat-value" id="totalStaff">60</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-database"></i> Data tersimpan lokal
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon checked">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Sudah Check-in</h3>
                                <div class="stat-value" id="checkedInCount">1</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-check-circle"></i> On Time
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon pending">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Belum Check-in</h3>
                                <div class="stat-value" id="pendingCount">59</div>
                                <div class="stat-trend trend-down">
                                    <i class="fas fa-exclamation-circle"></i> Perlu perhatian
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon shift">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Shift Aktif</h3>
                                <div class="stat-value" id="shiftCount">0</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-clock"></i> Teratur
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 style="font-size: 20px; color: var(--protogel-primary);">
                                <i class="fas fa-history"></i> Aktivitas Terbaru
                            </h3>
                            <button class="action-button success" id="checkinAllBtn">
                                <i class="fas fa-bolt"></i> Check-in Semua
                            </button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Staff</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Shift</th>
                                    <th>Waktu</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="dashboardTable">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Check-in Page -->
                <div id="checkinPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2 class="page-title"><i class="fas fa-clipboard-list"></i> Staff Check-in System</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-button shift" id="goToShiftBtn">
                                <i class="fas fa-clock"></i> Atur Shift
                            </button>
                            <button class="action-button" id="exportLocalBtn">
                                <i class="fas fa-download"></i> Backup
                            </button>
                            <button class="action-button filtered" id="exportFilteredBtn">
                                <i class="fas fa-filter"></i> Export Filtered
                            </button>
                            <button class="action-button success" id="quickCheckinBtn">
                                <i class="fas fa-bolt"></i> Check-in Cepat
                            </button>
                        </div>
                    </div>

                    <!-- Filter Section -->
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchStaff" placeholder="Cari staff...">
                            </div>
                            <select class="filter-select" id="filterRole">
                                <option value="all">Semua Role</option>
                                <option value="CS">CS</option>
                                <option value="Kapten">Kapten</option>
                                <option value="Kasir">Kasir</option>
                            </select>
                            <select class="filter-select" id="filterStatus">
                                <option value="all">Semua Status</option>
                                <option value="pending">Belum Check-in</option>
                                <option value="checked">Sudah Check-in</option>
                                <option value="absent">Tidak Hadir</option>
                            </select>
                            <select class="filter-select" id="filterShift">
                                <option value="all">Semua Shift</option>
                                <option value="Pagi">Pagi</option>
                                <option value="Siang">Siang</option>
                                <option value="Sore">Sore</option>
                                <option value="Malam">Malam</option>
                                <option value="Cuti">Cuti</option>
                            </select>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Staff</th>
                                    <th>Role</th>
                                    <th>Shift</th>
                                    <th>Status</th>
                                    <th>Waktu</th>
                                    <th>Diperiksa Oleh</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="checkinTable">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Manage Staff Page -->
                <div id="managePage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2 class="page-title"><i class="fas fa-users-cog"></i> Staff Management</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-button shift" id="goToShiftBtn2">
                                <i class="fas fa-clock"></i> Atur Shift
                            </button>
                            <button class="action-button" id="importDataBtn">
                                <i class="fas fa-upload"></i> Import Data
                            </button>
                            <button class="action-button" id="exportBtn">
                                <i class="fas fa-file-export"></i> Export Data
                            </button>
                        </div>
                    </div>

                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchManage" placeholder="Cari staff...">
                            </div>
                            <select class="filter-select" id="filterManageRole">
                                <option value="all">Semua Role</option>
                                <option value="CS">CS</option>
                                <option value="Kapten">Kapten</option>
                                <option value="Kasir">Kasir</option>
                            </select>
                            <button class="action-button" id="addStaffBtn">
                                <i class="fas fa-plus"></i> Tambah Staff
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Staff</th>
                                    <th>Role</th>
                                    <th>Shift</th>
                                    <th>Status</th>
                                    <th>Terakhir Check-in</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="manageTable">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Shift Management Page -->
                <div id="shiftPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2 class="page-title"><i class="fas fa-clock"></i> Shift Management</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="action-button success" id="assignAllShiftsBtn">
                                <i class="fas fa-calendar-alt"></i> Atur Semua
                            </button>
                            <button class="action-button danger" id="resetShiftBtn">
                                <i class="fas fa-redo"></i> Reset Shift
                            </button>
                            <button class="action-button print" id="printShiftBtn">
                                <i class="fas fa-print"></i> Cetak Jadwal
                            </button>
                        </div>
                    </div>

                    <!-- Filter Section -->
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchShift" placeholder="Cari staff...">
                            </div>
                            <select class="filter-select" id="filterShiftCategory">
                                <option value="all">Semua Shift</option>
                                <option value="Pagi">Pagi</option>
                                <option value="Siang">Siang</option>
                                <option value="Sore">Sore</option>
                                <option value="Malam">Malam</option>
                                <option value="Cuti">Cuti</option>
                            </select>
                            <select class="filter-select" id="filterShiftType">
                                <option value="all">Semua Tipe</option>
                                <option value="Senior">Senior</option>
                                <option value="Masa Training">Masa Training</option>
                                <option value="Kapten 1">Kapten 1</option>
                                <option value="Kapten 2">Kapten 2</option>
                            </select>
                        </div>
                    </div>

                    <!-- Shift Stats -->
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stat-card" style="background: linear-gradient(145deg, rgba(255, 211, 42, 0.1) 0%, rgba(26, 26, 46, 0.8) 100%);">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #ffd32a 0%, #ffb347 100%);">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Shift Pagi</h3>
                                <div class="stat-value" id="pagiCount">0</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-user-clock"></i> Aktif
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card" style="background: linear-gradient(145deg, rgba(0, 255, 136, 0.1) 0%, rgba(26, 26, 46, 0.8) 100%);">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Shift Siang</h3>
                                <div class="stat-value" id="siangCount">0</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-user-clock"></i> Aktif
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card" style="background: linear-gradient(145deg, rgba(255, 107, 0, 0.1) 0%, rgba(26, 26, 46, 0.8) 100%);">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #ff6b00 0%, #ff9a9e 100%);">
                                <i class="fas fa-sunset"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Shift Sore</h3>
                                <div class="stat-value" id="soreCount">0</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-user-clock"></i> Aktif
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card" style="background: linear-gradient(145deg, rgba(102, 126, 234, 0.1) 0%, rgba(26, 26, 46, 0.8) 100%);">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="fas fa-moon"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Shift Malam</h3>
                                <div class="stat-value" id="malamCount">0</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-user-clock"></i> Aktif
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shift Cards Display -->
                    <div style="margin-top: 40px;">
                        <div class="table-header">
                            <h3 style="font-size: 20px; color: var(--protogel-primary);">
                                <i class="fas fa-calendar-alt"></i> Jadwal Shift Staff
                            </h3>
                            <button class="action-button shift" id="newShiftBtn">
                                <i class="fas fa-plus"></i> Atur Shift Baru
                            </button>
                        </div>
                        <div class="shift-cards" id="shiftCardsContainer">
                            <!-- Shift cards will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Shift Table -->
                    <div class="table-container" style="margin-top: 40px;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Staff</th>
                                    <th>Shift</th>
                                    <th>Waktu</th>
                                    <th>Tipe</th>
                                    <th>Kategori</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="shiftTable">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Staff Page -->
                <div id="addPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2 class="page-title"><i class="fas fa-user-plus"></i> Tambah Staff Baru</h2>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
                        <div class="form-card">
                            <h3 style="color: var(--protogel-primary); margin-bottom: 20px; font-size: 20px;">
                                <i class="fas fa-info-circle"></i> Informasi Staff
                            </h3>
                            <div class="form-group">
                                <label class="form-label">Nama Lengkap Staff</label>
                                <input type="text" class="form-control" id="staffName" placeholder="Masukkan nama lengkap">
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label class="form-label">Role / Posisi</label>
                                    <select class="form-control" id="staffRole">
                                        <option value="CS">Customer Service (CS)</option>
                                        <option value="Kapten">Kapten</option>
                                        <option value="Kasir">Kasir</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Shift Default</label>
                                    <select class="form-control" id="staffShift">
                                        <option value="">-- Pilih Shift --</option>
                                        <option value="Pagi">Pagi</option>
                                        <option value="Siang">Siang</option>
                                        <option value="Sore">Sore</option>
                                        <option value="Malam">Malam</option>
                                        <option value="Cuti">Cuti</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="staffEmail" placeholder="staff@protogel.com">
                            </div>

                            <button class="action-button success" id="saveStaffBtn" style="width: 100%; padding: 18px; font-size: 17px;">
                                <i class="fas fa-save"></i> Simpan Staff Baru
                            </button>
                        </div>

                        <div class="form-card">
                            <h3 style="color: var(--protogel-primary); margin-bottom: 20px; font-size: 20px;">
                                <i class="fas fa-database"></i> Sistem Penyimpanan
                            </h3>
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 60px; color: var(--protogel-secondary); margin-bottom: 20px;">
                                    <i class="fas fa-database"></i>
                                </div>
                                <h4 style="color: var(--protogel-primary); font-size: 22px; margin-bottom: 15px;">Local Storage Aktif</h4>
                                <p style="color: rgba(255, 255, 255, 0.7); line-height: 1.6; margin-bottom: 20px;">
                                    Semua data staff dan check-in disimpan otomatis di browser Anda menggunakan <strong>Local Storage</strong>. Data tidak akan hilang meski browser ditutup atau halaman direfresh.
                                </p>
                                <div style="background: rgba(255, 107, 0, 0.1); border-radius: var(--border-radius-sm); padding: 15px; margin-top: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: rgba(255, 255, 255, 0.7);">Data tersimpan:</span>
                                        <span id="storageStatus" style="color: #00ff88; font-weight: bold;">Aktif</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: rgba(255, 255, 255, 0.7);">Ukuran data:</span>
                                        <span id="storageSize" style="color: var(--protogel-accent);">0 KB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 25px; color: var(--protogel-primary); font-size: 22px;">
                            <i class="fas fa-history"></i> Staff Terakhir Ditambahkan
                        </h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Role</th>
                                        <th>Shift</th>
                                        <th>Tanggal Ditambahkan</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="recentTable">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reportsPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2 class="page-title"><i class="fas fa-chart-bar"></i> Analytics Dashboard</h2>
                        <button class="action-button" id="exportReportBtn">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                    </div>
                    <div style="text-align: center; padding: 60px 20px; color: rgba(255, 255, 255, 0.6);">
                        <div class="logo-circle" style="width: 120px; height: 120px; margin: 0 auto 30px;">
                            <div class="logo-inner" style="width: 90px; height: 90px;">
                                <div class="logo-text" style="font-size: 36px;">P</div>
                            </div>
                        </div>
                        <h3 style="font-size: 24px; margin-bottom: 15px; color: var(--protogel-light);">PROTEGEL Analytics</h3>
                        <p style="max-width: 500px; margin: 0 auto; line-height: 1.8;">
                            Fitur analisis lengkap dengan grafik interaktif, trend analysis, dan predictive insights akan segera hadir.
                        </p>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settingsPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2 class="page-title"><i class="fas fa-cog"></i> System Settings</h2>
                    </div>
                    <div style="text-align: center; padding: 60px 20px; color: rgba(255, 255, 255, 0.6);">
                        <div class="logo-circle" style="width: 120px; height: 120px; margin: 0 auto 30px;">
                            <div class="logo-inner" style="width: 90px; height: 90px;">
                                <div class="logo-text" style="font-size: 36px;">P</div>
                            </div>
                        </div>
                        <h3 style="font-size: 24px; margin-bottom: 15px; color: var(--protogel-light);">PROTEGEL Settings</h3>
                        <p style="max-width: 500px; margin: 0 auto; line-height: 1.8;">
                            Konfigurasi sistem, notifikasi, dan integrasi akan tersedia di sini.
                        </p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Data Saved Indicator -->
    <div class="data-saved" id="dataSavedIndicator">
        <i class="fas fa-check-circle"></i>
        <span>Data berhasil disimpan!</span>
    </div>

    <!-- Edit Staff Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> Edit Data Staff</h3>
                <button class="modal-close" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
                    <div class="logo-circle" style="width: 60px; height: 60px;">
                        <div class="logo-inner" style="width: 45px; height: 45px;">
                            <div class="logo-text" style="font-size: 20px;">P</div>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: var(--protogel-primary); font-size: 18px;">PROTEGEL Staff Edit</h4>
                        <p style="color: rgba(255, 255, 255, 0.6); font-size: 14px;">Perubahan akan tersimpan otomatis</p>
                    </div>
                </div>
                
                <form id="editForm">
                    <input type="hidden" id="editId">
                    <div class="form-group">
                        <label class="form-label">Nama Staff</label>
                        <input type="text" class="form-control" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <select class="form-control" id="editRole" required>
                            <option value="CS">Customer Service (CS)</option>
                            <option value="Kapten">Kapten</option>
                            <option value="Kasir">Kasir</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Shift</label>
                        <select class="form-control" id="editShift">
                            <option value="">-- Pilih Shift --</option>
                            <option value="Pagi">Pagi</option>
                            <option value="Siang">Siang</option>
                            <option value="Sore">Sore</option>
                            <option value="Malam">Malam</option>
                            <option value="Cuti">Cuti</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status Check-in</label>
                        <select class="form-control" id="editStatus">
                            <option value="Belum Dicek">Belum Dicek</option>
                            <option value="Checked">Sudah Check-in</option>
                            <option value="Tidak Hadir">Tidak Hadir</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 30px;">
                        <button type="submit" class="action-button" id="saveEditBtn">
                            <i class="fas fa-save"></i> Simpan
                        </button>
                        <button type="button" class="action-button shift" id="editShiftBtn">
                            <i class="fas fa-clock"></i> Atur Shift
                        </button>
                        <button type="button" class="action-button danger" id="deleteStaffBtn">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Shift Management Modal -->
    <div class="modal" id="shiftModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-clock"></i> Atur Shift Staff</h3>
                <button class="modal-close" id="closeShiftModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
                    <div class="logo-circle" style="width: 60px; height: 60px; background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%);">
                        <div class="logo-inner" style="width: 45px; height: 45px;">
                            <div class="logo-text" style="font-size: 20px; background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%);">S</div>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: var(--protogel-primary); font-size: 18px;">PROTEGEL Shift Management</h4>
                        <p style="color: rgba(255, 255, 255, 0.6); font-size: 14px;">Pilih shift untuk staff</p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Pilih Staff</label>
                    <select class="form-control" id="shiftStaffSelect" required>
                        <option value="">-- Pilih Staff --</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Kategori Shift</label>
                    <select class="form-control" id="shiftCategorySelect" required>
                        <option value="">-- Pilih Kategori --</option>
                        <option value="Pagi">Pagi</option>
                        <option value="Siang">Siang</option>
                        <option value="Sore">Sore</option>
                        <option value="Malam">Malam</option>
                        <option value="Cuti">Cuti</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Pilih Shift</label>
                    <div class="shift-options-grid" id="shiftOptionsContainer">
                        <!-- Shift options will be populated by JavaScript -->
                    </div>
                </div>

                <div id="selectedShiftInfo" style="display: none; background: rgba(255, 107, 0, 0.1); border-radius: var(--border-radius-sm); padding: 20px; margin-top: 20px;">
                    <h4 style="color: var(--protogel-primary); margin-bottom: 10px;">Shift Terpilih:</h4>
                    <div id="selectedShiftDetails"></div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <button type="button" class="action-button success" id="saveShiftBtn">
                        <i class="fas fa-save"></i> Simpan Shift
                    </button>
                    <button type="button" class="action-button danger" id="removeShiftBtn">
                        <i class="fas fa-trash"></i> Hapus Shift
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal" id="resetModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Konfirmasi Reset</h3>
                <button class="modal-close" id="closeResetModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div class="logo-circle" style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, #ff0055 0%, #ff5500 100%);">
                        <div class="logo-inner" style="width: 60px; height: 60px;">
                            <div class="logo-text" style="font-size: 30px; background: linear-gradient(135deg, #ff0055 0%, #ff5500 100%);">!</div>
                        </div>
                    </div>
                    <h4 style="color: var(--protogel-primary); font-size: 20px; margin-bottom: 10px;" id="resetTitle">Reset Data</h4>
                    <p id="resetMessage">Pilih jenis reset yang ingin dilakukan:</p>
                </div>
                
                <div class="reset-options" style="display: grid; gap: 15px;">
                    <div class="reset-option" data-type="shift">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; border-radius: 10px; background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div style="flex: 1;">
                                <h5 style="color: var(--protogel-light); margin-bottom: 5px;">Reset Shift</h5>
                                <p style="font-size: 14px; color: rgba(255, 255, 255, 0.7);">
                                    Mengembalikan semua shift ke kondisi awal (belum diatur)
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="reset-option" data-type="checkin">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; border-radius: 10px; background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div style="flex: 1;">
                                <h5 style="color: var(--protogel-light); margin-bottom: 5px;">Reset Check-in</h5>
                                <p style="font-size: 14px; color: rgba(255, 255, 255, 0.7);">
                                    Mengembalikan semua status check-in ke "Belum Dicek"
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="reset-option" data-type="all">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; border-radius: 10px; background: linear-gradient(135deg, #ff0055 0%, #ff5500 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                                <i class="fas fa-bomb"></i>
                            </div>
                            <div style="flex: 1;">
                                <h5 style="color: var(--protogel-light); margin-bottom: 5px;">Reset Semua</h5>
                                <p style="font-size: 14px; color: rgba(255, 255, 255, 0.7);">
                                    Reset shift dan check-in sekaligus
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="resetConfirmation" style="display: none; margin-top: 20px;">
                    <div style="background: rgba(255, 107, 0, 0.1); border-radius: var(--border-radius-sm); padding: 15px; margin-bottom: 20px;">
                        <p style="color: rgba(255, 255, 255, 0.8);" id="confirmationText"></p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button class="action-button danger" id="confirmResetBtn">
                            <i class="fas fa-check"></i> Ya, Reset
                        </button>
                        <button class="action-button" id="cancelResetBtn">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // SHIFT DATA CONFIGURATION
        // ============================================

        const shiftTemplates = {
            "Pagi": [
                {
                    id: "pagi1",
                    name: "Pagi 07:45:00 s/d 17:45:00",
                    category: "Senior",
                    time: "07:45 - 17:45",
                    description: "Pagi Senior 07:45:00 s/d 17:45:00"
                },
                {
                    id: "pagi2",
                    name: "Pagi 07:45:00 s/d 19:45:00",
                    category: "Masa Training",
                    time: "07:45 - 19:45",
                    description: "Pagi Training 07:45:00 s/d 19:45:00"
                },
                {
                    id: "pagi3",
                    name: "Pagi 09:45:00 s/d 19:45:00",
                    category: "Senior",
                    time: "09:45 - 19:45",
                    description: "Pagi Senior 09:45:00 s/d 19:45:00"
                },
                {
                    id: "pagi4",
                    name: "Pagi 09:45:00 s/d 21:45:00",
                    category: "Masa Training",
                    time: "09:45 - 21:45",
                    description: "Pagi Training 09:45:00 s/d 21:45:00"
                },
                {
                    id: "pagi5",
                    name: "Pagi 07:45:00 s/d 17:45:00",
                    category: "Kapten 1",
                    time: "07:45 - 17:45",
                    description: "Pagi Kapten 1 07:45:00 s/d 17:45:00"
                },
                {
                    id: "pagi6",
                    name: "Pagi 07:45:00 s/d 17:45:00",
                    category: "Kapten 2",
                    time: "07:45 - 17:45",
                    description: "Pagi Kapten 2 07:45:00 s/d 17:45:00"
                }
            ],
            "Siang": [
                {
                    id: "siang1",
                    name: "Siang 11:45:00 s/d 21:45:00",
                    category: "Senior",
                    time: "11:45 - 21:45",
                    description: "Siang Senior 11:45:00 s/d 21:45:00"
                },
                {
                    id: "siang2",
                    name: "Siang 11:45:00 s/d 23:45:00",
                    category: "Masa Training",
                    time: "11:45 - 23:45",
                    description: "Siang Training 11:45:00 s/d 23:45:00"
                }
            ],
            "Sore": [
                {
                    id: "sore1",
                    name: "Sore 14:45:00 s/d 00:45:00",
                    category: "Senior",
                    time: "14:45 - 00:45",
                    description: "Sore Senior 14:45:00 s/d 00:45:00"
                },
                {
                    id: "sore2",
                    name: "Sore 15:45:00 s/d 01:45:00",
                    category: "Senior",
                    time: "15:45 - 01:45",
                    description: "Sore Senior 15:45:00 s/d 01:45:00"
                },
                {
                    id: "sore3",
                    name: "Sore 13:45:00 s/d 01:45:00",
                    category: "Masa Training",
                    time: "13:45 - 01:45",
                    description: "Sore Training 13:45:00 s/d 01:45:00"
                },
                {
                    id: "sore4",
                    name: "Sore 15:45:00 s/d 01:45:00",
                    category: "Kapten 1",
                    time: "15:45 - 01:45",
                    description: "Sore Kapten 1 15:45:00 s/d 01:45:00"
                },
                {
                    id: "sore5",
                    name: "Sore 15:45:00 s/d 01:45:00",
                    category: "Kapten 2",
                    time: "15:45 - 01:45",
                    description: "Sore Kapten 2 15:45:00 s/d 01:45:00"
                }
            ],
            "Malam": [
                {
                    id: "malam1",
                    name: "Malam 19:45:00 s/d 07:45:00",
                    category: "Masa Training",
                    time: "19:45 - 07:45",
                    description: "Malam Training 19:45:00 s/d 07:45:00"
                },
                {
                    id: "malam2",
                    name: "Malam 21:45:00 s/d 07:45:00",
                    category: "Senior",
                    time: "21:45 - 07:45",
                    description: "Malam Senior 21:45:00 s/d 07:45:00"
                },
                {
                    id: "malam3",
                    name: "Malam 21:45:00 s/d 07:45:00",
                    category: "Kapten 1",
                    time: "21:45 - 07:45",
                    description: "Malam Kapten 1 21:45:00 s/d 07:45:00"
                },
                {
                    id: "malam4",
                    name: "Malam 21:45:00 s/d 07:45:00",
                    category: "Kapten 2",
                    time: "21:45 - 07:45",
                    description: "Malam Kapten 2 21:45:00 s/d 07:45:00"
                }
            ],
            "Cuti": [
                {
                    id: "cuti1",
                    name: "Sedang Cuti",
                    category: "Cuti",
                    time: "00:00 - 00:00",
                    description: "Sedang Cuti"
                }
            ]
        };

        // ============================================
        // GLOBAL VARIABLES
        // ============================================

        const staffNames = [
            "GILBERT VINCENT",
            "FIRZA LUDHFAN HAKIM SARAGIH", 
            "RIVALDY JOSUA TAMPUBOLON",
            "FRENGKY",
            "MUHAMMAD FAHMI ELFAROQI",
            "RITA",
            "CAHAYA GINTING",
            "AJENG FEBRIANTI",
            "MUHAMMAD EQI WINDANI",
            "WIJE PILLY",
            "M RIZA HIDAYATULLAH",
            "RAJ NISEL",
            "MUHAMMAD DAFFA",
            "ROMY VINTARA",
            "LUIS FERNANDO",
            "FATHUR RAHMAN PERMONO",
            "VEREN",
            "KHUSNUL KHOTIB HUTAGALUNG",
            "YOGA PRANANDA SINULINGGA",
            "KHUSNI MAULANA",
            "REYNAL SYAFRI LUBIS",
            "DORMANITA SILABAN",
            "SANJIWI ROY",
            "HANDOKO SYAHPUTRA",
            "DICKY PERMANA",
            "MHD RAMANDA ALFIAN",
            "HENDRA RANDEBUA",
            "ARI PANGESTU",
            "SAQIB",
            "INKA SAFITRI",
            "MUHAMMAD ANDRA SYAHPUTRA",
            "FRANSISKA",
            "LIDIA INDRIANI",
            "ASRARIL AKMAL",
            "ONI DAYANTI",
            "ROY RAJAGUKGUK",
            "SAHIL KANA",
            "NOVRIANSYAH",
            "MUNTAS FAZIRA",
            "FITRA PRAYOGO",
            "SONYANTO",
            "MUHAMMAD RIZKI",
            "RIDHO EDWANDA",
            "MUHAMMAD RIZKI PURWANDI",
            "PRICILLA ANGGRAINI",
            "ALVIN",
            "HERI WIBOWO",
            "DINI SUKMA S",
            "INTAN SAFITRI",
            "JANDRI SITANGGANG",
            "MOHAMAD HENDRIK",
            "WAHYUDI PRAYOGA RANGKUTI",
            "M ORIZHA PUTRA SASMIFTA",
            "MIFTA HULZANNAH",
            "HENDRY TANOTO",
            "RIDHO ZULFIKAR",
            "RIYAN MAULANA IBRAHIM"
        ];

        let staffData = [];
        let recentAdded = [];
        let shiftData = {};
        let selectedShiftOption = null;

        // ============================================
        // LOCAL STORAGE FUNCTIONS
        // ============================================

        function saveToLocalStorage() {
            try {
                const dataToSave = {
                    staffData: staffData,
                    recentAdded: recentAdded,
                    shiftData: shiftData,
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('protogelStaffData', JSON.stringify(dataToSave));
                showDataSaved();
                updateStorageInfo();
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                showNotification('Gagal menyimpan data', 'error');
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('protogelStaffData');
                
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    
                    if (parsedData.staffData && Array.isArray(parsedData.staffData)) {
                        staffData = parsedData.staffData;
                        recentAdded = parsedData.recentAdded || [];
                        shiftData = parsedData.shiftData || {};
                        
                        showNotification('Data berhasil dimuat dari penyimpanan lokal', 'success');
                        return true;
                    }
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
            }
            
            return false;
        }

        function showDataSaved() {
            const indicator = document.getElementById('dataSavedIndicator');
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function updateStorageInfo() {
            try {
                const savedData = localStorage.getItem('protogelStaffData');
                if (savedData) {
                    const size = (savedData.length / 1024).toFixed(2);
                    document.getElementById('storageSize').textContent = `${size} KB`;
                    document.getElementById('storageStatus').textContent = 'Aktif';
                    document.getElementById('storageStatus').style.color = '#00ff88';
                } else {
                    document.getElementById('storageSize').textContent = '0 KB';
                    document.getElementById('storageStatus').textContent = 'Tidak aktif';
                    document.getElementById('storageStatus').style.color = '#ff5555';
                }
            } catch (error) {
                console.error('Error updating storage info:', error);
            }
        }

        // ============================================
        // INITIALIZATION FUNCTIONS
        // ============================================

        function initializeData() {
            if (!loadFromLocalStorage()) {
                staffData = [];
                
                // Add first staff with shift
                staffData.push({
                    id: 1,
                    name: "GILBERT VINCENT",
                    role: "CS",
                    status: "Checked",
                    time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' }),
                    checkedBy: "PROTEGEL ADMIN",
                    email: "gilbert@protogel.com",
                    notes: "Staff teladan",
                    dateAdded: new Date().toISOString().split('T')[0],
                    shift: "Pagi"
                });

                // Add shift data for first staff
                shiftData[1] = {
                    staffId: 1,
                    shiftName: "Pagi 07:45:00 s/d 17:45:00",
                    shiftCategory: "Pagi",
                    shiftType: "Senior",
                    shiftTime: "07:45 - 17:45"
                };

                for (let i = 1; i < staffNames.length; i++) {
                    let role = "CS";
                    if (i % 3 === 0) role = "Kapten";
                    if (i % 5 === 0) role = "Kasir";
                    if (i % 7 === 0) role = "CS";

                    let shift = "";
                    if (i % 4 === 0) shift = "Pagi";
                    else if (i % 4 === 1) shift = "Siang";
                    else if (i % 4 === 2) shift = "Sore";
                    else shift = "Malam";

                    staffData.push({
                        id: i + 1,
                        name: staffNames[i],
                        role: role,
                        status: "Belum Dicek",
                        time: "-",
                        checkedBy: "-",
                        email: "",
                        notes: "",
                        dateAdded: new Date().toISOString().split('T')[0],
                        shift: shift
                    });
                }

                saveToLocalStorage();
            }

            recentAdded = [...staffData.slice(-5)].reverse();
            updateStats();
            updateStorageInfo();
            updateShiftStats();
        }

        function updateClock() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            
            // Format tanggal Indonesia
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const dayName = days[now.getDay()];
            const date = now.getDate();
            const monthName = months[now.getMonth()];
            const year = now.getFullYear();
            
            // Format waktu
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const dateStr = `${dayName}, ${date} ${monthName} ${year}`;
            const timeStr = `${hours}:${minutes}:${seconds}`;
            
            document.getElementById('currentDateTime').textContent = `${dateStr} | ${timeStr}`;
        }

        function updateStats() {
            const total = staffData.length;
            const checked = staffData.filter(s => s.status === 'Checked').length;
            const absent = staffData.filter(s => s.status === 'Tidak Hadir').length;
            const pending = total - checked - absent;
            const shiftCount = Object.keys(shiftData).length;

            document.getElementById('totalStaff').textContent = total;
            document.getElementById('checkedInCount').textContent = checked;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('pendingBadge').textContent = pending;
            document.getElementById('shiftCount').textContent = shiftCount;
        }

        function updateShiftStats() {
            const pagi = staffData.filter(s => s.shift === 'Pagi').length;
            const siang = staffData.filter(s => s.shift === 'Siang').length;
            const sore = staffData.filter(s => s.shift === 'Sore').length;
            const malam = staffData.filter(s => s.shift === 'Malam').length;

            document.getElementById('pagiCount').textContent = pagi;
            document.getElementById('siangCount').textContent = siang;
            document.getElementById('soreCount').textContent = sore;
            document.getElementById('malamCount').textContent = malam;
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 30px;
                right: 30px;
                background: ${type === 'success' ? 'rgba(0, 255, 136, 0.9)' : 'rgba(255, 0, 85, 0.9)'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 3000;
                transform: translateX(150%);
                transition: transform 0.3s ease;
                max-width: 400px;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(150%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ============================================
        // RESET FUNCTIONS
        // ============================================

        function openResetModal() {
            const modal = document.getElementById('resetModal');
            const confirmationDiv = document.getElementById('resetConfirmation');
            
            // Reset state
            document.querySelectorAll('.reset-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            confirmationDiv.style.display = 'none';
            document.getElementById('resetTitle').textContent = 'Reset Data';
            document.getElementById('resetMessage').textContent = 'Pilih jenis reset yang ingin dilakukan:';
            
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
        }

        function closeResetModal() {
            const modal = document.getElementById('resetModal');
            modal.style.display = 'none';
            document.body.classList.remove('modal-open');
        }

        function resetShiftData() {
            // Reset all shifts to empty
            staffData.forEach(staff => {
                staff.shift = '';
            });
            
            // Clear shift data
            shiftData = {};
            
            updateStats();
            updateShiftStats();
            renderAllTables();
            saveToLocalStorage();
            
            showNotification('Semua shift berhasil direset ke kondisi awal', 'success');
        }

        function resetCheckinData() {
            // Reset all check-ins to pending
            staffData.forEach(staff => {
                if (staff.status === 'Checked' || staff.status === 'Tidak Hadir') {
                    staff.status = 'Belum Dicek';
                    staff.time = '-';
                    staff.checkedBy = '-';
                }
            });
            
            updateStats();
            renderAllTables();
            saveToLocalStorage();
            
            showNotification('Semua check-in berhasil direset', 'success');
        }

        function resetAllData() {
            // Reset both shift and check-in
            staffData.forEach(staff => {
                staff.shift = '';
                if (staff.status === 'Checked' || staff.status === 'Tidak Hadir') {
                    staff.status = 'Belum Dicek';
                    staff.time = '-';
                    staff.checkedBy = '-';
                }
            });
            
            shiftData = {};
            
            updateStats();
            updateShiftStats();
            renderAllTables();
            saveToLocalStorage();
            
            showNotification('Semua data berhasil direset ke kondisi awal', 'success');
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================

        function renderAllTables() {
            renderDashboardTable();
            renderCheckinTable();
            renderManageTable();
            renderRecentTable();
            renderShiftTable();
            renderShiftCards();
        }

        function renderDashboardTable() {
            const container = document.getElementById('dashboardTable');
            const checkedInStaff = staffData.filter(s => s.status === 'Checked').slice(0, 10);
            
            if (checkedInStaff.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 50px;">
                            <div style="color: rgba(255, 255, 255, 0.6);">
                                <div class="logo-circle" style="width: 60px; height: 60px; margin: 0 auto 20px;">
                                    <div class="logo-inner" style="width: 45px; height: 45px;">
                                        <div class="logo-text" style="font-size: 20px;">P</div>
                                    </div>
                                </div>
                                <p style="font-size: 18px; margin-top: 20px;">Belum ada staff yang check-in hari ini</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            container.innerHTML = checkedInStaff.map(staff => {
                const initials = staff.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                const shiftBadge = staff.shift ? 
                    `<span class="shift-badge shift-${staff.shift.toLowerCase()}">${staff.shift}</span>` : 
                    '<span style="color: rgba(255,255,255,0.4);">-</span>';
                
                return `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 45px; height: 45px; border-radius: 50%; background: var(--protogel-gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
                                ${initials}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${staff.name}</div>
                                <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">ID: PROT${staff.id.toString().padStart(3, '0')}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="role-badge role-${staff.role.toLowerCase()}">${staff.role}</span></td>
                    <td>
                        <span class="status-badge status-checked">
                            <i class="fas fa-check-circle"></i>
                            Sudah Check-in
                        </span>
                    </td>
                    <td>${shiftBadge}</td>
                    <td><strong>${staff.time}</strong></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit" onclick="editStaff(${staff.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-checkin" onclick="undoCheckin(${staff.id})" title="Batalkan Check-in">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="btn-icon btn-shift" onclick="openShiftModal(${staff.id})" title="Atur Shift">
                                <i class="fas fa-clock"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
            }).join('');
        }

        function renderCheckinTable() {
            const container = document.getElementById('checkinTable');
            const search = document.getElementById('searchStaff').value.toLowerCase();
            const roleFilter = document.getElementById('filterRole').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const shiftFilter = document.getElementById('filterShift').value;

            let filtered = staffData.filter(staff => {
                if (search && !staff.name.toLowerCase().includes(search)) return false;
                if (roleFilter !== 'all' && staff.role !== roleFilter) return false;
                if (statusFilter !== 'all') {
                    if (statusFilter === 'pending' && staff.status !== 'Belum Dicek') return false;
                    if (statusFilter === 'checked' && staff.status !== 'Checked') return false;
                    if (statusFilter === 'absent' && staff.status !== 'Tidak Hadir') return false;
                }
                if (shiftFilter !== 'all' && staff.shift !== shiftFilter) return false;
                return true;
            });

            if (filtered.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 50px;">
                            <div style="color: rgba(255, 255, 255, 0.6);">
                                <div class="logo-circle" style="width: 60px; height: 60px; margin: 0 auto 20px;">
                                    <div class="logo-inner" style="width: 45px; height: 45px;">
                                        <div class="logo-text" style="font-size: 20px;">P</div>
                                    </div>
                                </div>
                                <p style="font-size: 18px; margin-top: 20px;">Tidak ada staff yang sesuai dengan filter</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            container.innerHTML = filtered.map(staff => {
                const initials = staff.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                let statusClass = '';
                let statusText = '';
                let statusIcon = '';
                
                if (staff.status === 'Checked') {
                    statusClass = 'status-checked';
                    statusText = 'Sudah Check-in';
                    statusIcon = 'check-circle';
                } else if (staff.status === 'Tidak Hadir') {
                    statusClass = 'status-absent';
                    statusText = 'Tidak Hadir';
                    statusIcon = 'user-times';
                } else {
                    statusClass = 'status-pending';
                    statusText = 'Belum Check-in';
                    statusIcon = 'clock';
                }
                
                const shiftBadge = staff.shift ? 
                    `<span class="shift-badge shift-${staff.shift.toLowerCase()}">${staff.shift}</span>` : 
                    '<span style="color: rgba(255,255,255,0.4);">-</span>';
                
                const shiftDetails = shiftData[staff.id] ? 
                    `<div style="font-size: 12px; color: rgba(255,255,255,0.6);">${shiftData[staff.id].shiftTime}</div>` : '';
                
                return `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 45px; height: 45px; border-radius: 50%; background: ${staff.status === 'Belum Dicek' ? 'rgba(26, 26, 46, 0.8)' : staff.status === 'Tidak Hadir' ? 'linear-gradient(135deg, #ff0055 0%, #ff5500 100%)' : 'var(--protogel-gradient)'}; display: flex; align-items: center; justify-content: center; color: ${staff.status === 'Belum Dicek' ? 'rgba(255, 255, 255, 0.6)' : 'white'}; font-weight: 700; font-size: 16px;">
                                ${initials}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${staff.name}</div>
                                <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">ID: PROT${staff.id.toString().padStart(3, '0')}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="role-badge role-${staff.role.toLowerCase()}">${staff.role}</span></td>
                    <td>
                        ${shiftBadge}
                        ${shiftDetails}
                    </td>
                    <td>
                        <span class="status-badge ${statusClass}">
                            <i class="fas fa-${statusIcon}"></i>
                            ${statusText}
                        </span>
                    </td>
                    <td><strong>${staff.time}</strong></td>
                    <td>${staff.checkedBy}</td>
                    <td>
                        <div class="action-buttons">
                            ${staff.status === 'Belum Dicek' ? `
                                <button class="btn-icon btn-checkin" onclick="checkinStaff(${staff.id})" title="Check-in">
                                    <i class="fas fa-user-check"></i>
                                </button>
                            ` : staff.status === 'Tidak Hadir' ? `
                                <button class="btn-icon btn-checkin" onclick="markAsPresent(${staff.id})" title="Tandai Hadir">
                                    <i class="fas fa-user-check"></i>
                                </button>
                            ` : `
                                <button class="btn-icon" style="background: rgba(255,255,255,0.1);" onclick="undoCheckin(${staff.id})" title="Batalkan Check-in">
                                    <i class="fas fa-undo"></i>
                                </button>
                            `}
                            <button class="btn-icon btn-edit" onclick="editStaff(${staff.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-shift" onclick="openShiftModal(${staff.id})" title="Atur Shift">
                                <i class="fas fa-clock"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
            }).join('');
        }

        function renderManageTable() {
            const container = document.getElementById('manageTable');
            const search = document.getElementById('searchManage').value.toLowerCase();
            const roleFilter = document.getElementById('filterManageRole').value;

            let filtered = staffData.filter(staff => {
                if (search && !staff.name.toLowerCase().includes(search)) return false;
                if (roleFilter !== 'all' && staff.role !== roleFilter) return false;
                return true;
            });

            if (filtered.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 50px;">
                            <div style="color: rgba(255, 255, 255, 0.6);">
                                <div class="logo-circle" style="width: 60px; height: 60px; margin: 0 auto 20px;">
                                    <div class="logo-inner" style="width: 45px; height: 45px;">
                                        <div class="logo-text" style="font-size: 20px;">P</div>
                                    </div>
                                </div>
                                <p style="font-size: 18px; margin-top: 20px;">Tidak ada staff ditemukan</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            container.innerHTML = filtered.map(staff => {
                const initials = staff.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                let statusClass = '';
                let statusIcon = '';
                
                if (staff.status === 'Checked') {
                    statusClass = 'status-checked';
                    statusIcon = 'check-circle';
                } else if (staff.status === 'Tidak Hadir') {
                    statusClass = 'status-absent';
                    statusIcon = 'user-times';
                } else {
                    statusClass = 'status-pending';
                    statusIcon = 'clock';
                }
                
                const shiftBadge = staff.shift ? 
                    `<span class="shift-badge shift-${staff.shift.toLowerCase()}">${staff.shift}</span>` : 
                    '<span style="color: rgba(255,255,255,0.4);">-</span>';
                
                return `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; border-radius: 50%; background: var(--protogel-gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 18px;">
                                ${initials}
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 16px;">${staff.name}</div>
                                <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">ID: PROT${staff.id.toString().padStart(3, '0')}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="role-badge role-${staff.role.toLowerCase()}">${staff.role}</span></td>
                    <td>${shiftBadge}</td>
                    <td>
                        <span class="status-badge ${statusClass}">
                            <i class="fas fa-${statusIcon}"></i>
                            ${staff.status}
                        </span>
                    </td>
                    <td>${staff.time === '-' ? 'Belum pernah' : staff.time}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit" onclick="editStaff(${staff.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-shift" onclick="openShiftModal(${staff.id})" title="Atur Shift">
                                <i class="fas fa-clock"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteStaff(${staff.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
            }).join('');
        }

        function renderShiftTable() {
            const container = document.getElementById('shiftTable');
            const search = document.getElementById('searchShift').value.toLowerCase();
            const categoryFilter = document.getElementById('filterShiftCategory').value;
            const typeFilter = document.getElementById('filterShiftType').value;

            // Get staff with shift data
            let staffWithShifts = staffData.filter(staff => {
                if (search && !staff.name.toLowerCase().includes(search)) return false;
                if (categoryFilter !== 'all' && staff.shift !== categoryFilter) return false;
                return true;
            });

            // Further filter by shift type if applicable
            if (typeFilter !== 'all') {
                staffWithShifts = staffWithShifts.filter(staff => {
                    const shift = shiftData[staff.id];
                    return shift && shift.shiftType === typeFilter;
                });
            }

            if (staffWithShifts.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 50px;">
                            <div style="color: rgba(255, 255, 255, 0.6);">
                                <div class="logo-circle" style="width: 60px; height: 60px; margin: 0 auto 20px;">
                                    <div class="logo-inner" style="width: 45px; height: 45px;">
                                        <div class="logo-text" style="font-size: 20px;">S</div>
                                    </div>
                                </div>
                                <p style="font-size: 18px; margin-top: 20px;">Belum ada shift yang diatur</p>
                                <button class="action-button shift" onclick="openShiftModal(null)" style="margin-top: 20px;">
                                    <i class="fas fa-plus"></i> Atur Shift Pertama
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            container.innerHTML = staffWithShifts.map(staff => {
                const shift = shiftData[staff.id];
                const initials = staff.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                
                let shiftTypeClass = '';
                let shiftTypeText = shift ? shift.shiftType : '-';
                
                if (shiftTypeText.includes('Senior')) shiftTypeClass = 'senior';
                else if (shiftTypeText.includes('Training')) shiftTypeClass = 'training';
                else if (shiftTypeText.includes('Kapten')) shiftTypeClass = 'kapten';
                else if (shiftTypeText.includes('Cuti')) shiftTypeClass = 'cuti';
                
                return `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 45px; height: 45px; border-radius: 50%; background: var(--protogel-gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
                                ${initials}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${staff.name}</div>
                                <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">ID: PROT${staff.id.toString().padStart(3, '0')}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="shift-badge shift-${staff.shift ? staff.shift.toLowerCase() : 'cuti'}">
                            ${staff.shift || 'Belum diatur'}
                        </span>
                    </td>
                    <td>
                        <div style="font-weight: 600;">${shift ? shift.shiftTime : '-'}</div>
                        <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">${shift ? shift.shiftName : '-'}</div>
                    </td>
                    <td>
                        <span class="shift-category ${shiftTypeClass}">${shiftTypeText}</span>
                    </td>
                    <td>${staff.shift || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit" onclick="editStaff(${staff.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-shift" onclick="openShiftModal(${staff.id})" title="Ubah Shift">
                                <i class="fas fa-clock"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
            }).join('');
        }

        function renderShiftCards() {
            const container = document.getElementById('shiftCardsContainer');
            
            // Group staff by shift
            const staffByShift = {
                'Pagi': staffData.filter(s => s.shift === 'Pagi'),
                'Siang': staffData.filter(s => s.shift === 'Siang'),
                'Sore': staffData.filter(s => s.shift === 'Sore'),
                'Malam': staffData.filter(s => s.shift === 'Malam'),
                'Cuti': staffData.filter(s => s.shift === 'Cuti' || !s.shift)
            };

            let cardsHTML = '';
            
            for (const [shiftName, staffList] of Object.entries(staffByShift)) {
                if (staffList.length === 0) continue;
                
                cardsHTML += `
                <div class="shift-card-item ${shiftName.toLowerCase()}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: var(--protogel-light); font-size: 18px;">
                            <i class="fas fa-${shiftName === 'Pagi' ? 'sun' : shiftName === 'Siang' ? 'clock' : shiftName === 'Sore' ? 'sunset' : shiftName === 'Malam' ? 'moon' : 'bed'}"></i>
                            Shift ${shiftName}
                        </h4>
                        <span class="shift-badge shift-${shiftName.toLowerCase()}">${staffList.length} Staff</span>
                    </div>
                    <div style="max-height: 200px; overflow-y: auto;">
                `;
                
                staffList.slice(0, 5).forEach(staff => {
                    const shift = shiftData[staff.id];
                    cardsHTML += `
                    <div style="padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div class="shift-staff-name">${staff.name}</div>
                        <div class="shift-time">${shift ? shift.shiftTime : 'Belum diatur'}</div>
                        ${shift ? `<span class="shift-category ${shift.shiftType === 'Senior' ? 'senior' : shift.shiftType === 'Masa Training' ? 'training' : 'kapten'}">${shift.shiftType}</span>` : ''}
                    </div>
                    `;
                });
                
                if (staffList.length > 5) {
                    cardsHTML += `
                    <div style="padding: 10px; text-align: center; color: rgba(255,255,255,0.6);">
                        + ${staffList.length - 5} staff lainnya
                    </div>
                    `;
                }
                
                cardsHTML += `
                    </div>
                </div>
                `;
            }
            
            container.innerHTML = cardsHTML || `
                <div style="grid-column: 1/-1; text-align: center; padding: 50px;">
                    <div style="color: rgba(255, 255, 255, 0.6);">
                        <div class="logo-circle" style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%);">
                            <div class="logo-inner" style="width: 60px; height: 60px;">
                                <div class="logo-text" style="font-size: 30px; background: linear-gradient(135deg, #9d4edd 0%, #5a189a 100%);">S</div>
                            </div>
                        </div>
                        <h3 style="font-size: 22px; margin-bottom: 10px; color: var(--protogel-light);">Belum Ada Shift</h3>
                        <p style="max-width: 400px; margin: 0 auto 20px; line-height: 1.6;">
                            Atur shift untuk staff Anda. Klik tombol di atas untuk memulai.
                        </p>
                        <button class="action-button shift" onclick="openShiftModal(null)">
                            <i class="fas fa-plus"></i> Atur Shift Pertama
                        </button>
                    </div>
                </div>
            `;
        }

        function renderRecentTable() {
            const container = document.getElementById('recentTable');
            
            if (recentAdded.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 50px;">
                            <div style="color: rgba(255, 255, 255, 0.6);">
                                <div class="logo-circle" style="width: 60px; height: 60px; margin: 0 auto 20px;">
                                    <div class="logo-inner" style="width: 45px; height: 45px;">
                                        <div class="logo-text" style="font-size: 20px;">P</div>
                                    </div>
                                </div>
                                <p style="font-size: 18px; margin-top: 20px;">Belum ada staff yang ditambahkan</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            container.innerHTML = recentAdded.map(staff => {
                const initials = staff.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                const shiftBadge = staff.shift ? 
                    `<span class="shift-badge shift-${staff.shift.toLowerCase()}">${staff.shift}</span>` : 
                    '<span style="color: rgba(255,255,255,0.4);">-</span>';
                
                return `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 45px; height: 45px; border-radius: 50%; background: var(--protogel-gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
                                ${initials}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${staff.name}</div>
                                <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">ID: PROT${staff.id.toString().padStart(3, '0')}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="role-badge role-${staff.role.toLowerCase()}">${staff.role}</span></td>
                    <td>${shiftBadge}</td>
                    <td>${new Date(staff.dateAdded).toLocaleDateString('id-ID', { 
                        day: '2-digit', 
                        month: 'short', 
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit" onclick="editStaff(${staff.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-shift" onclick="openShiftModal(${staff.id})" title="Atur Shift">
                                <i class="fas fa-clock"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
            }).join('');
        }

        // ============================================
        // SHIFT MANAGEMENT FUNCTIONS
        // ============================================

        function openShiftModal(staffId) {
            const modal = document.getElementById('shiftModal');
            const staffSelect = document.getElementById('shiftStaffSelect');
            const categorySelect = document.getElementById('shiftCategorySelect');
            const optionsContainer = document.getElementById('shiftOptionsContainer');
            
            // Reset selection
            selectedShiftOption = null;
            document.getElementById('selectedShiftInfo').style.display = 'none';
            
            // Populate staff select
            staffSelect.innerHTML = '<option value="">-- Pilih Staff --</option>';
            staffData.forEach(staff => {
                const option = document.createElement('option');
                option.value = staff.id;
                option.textContent = staff.name;
                staffSelect.appendChild(option);
            });
            
            // If staffId is provided, select that staff
            if (staffId) {
                staffSelect.value = staffId;
                
                // If staff already has shift data, show it
                if (shiftData[staffId]) {
                    const shift = shiftData[staffId];
                    categorySelect.value = shift.shiftCategory;
                    loadShiftOptions(shift.shiftCategory, staffId);
                    
                    // Find and select the matching shift option
                    setTimeout(() => {
                        const shiftOptions = document.querySelectorAll('.shift-option');
                        shiftOptions.forEach(option => {
                            const shiftId = option.dataset.shiftId;
                            if (shiftId === shift.shiftName) {
                                option.classList.add('selected');
                                selectedShiftOption = {
                                    id: shiftId,
                                    name: shift.shiftName,
                                    category: shift.shiftCategory,
                                    type: shift.shiftType,
                                    time: shift.shiftTime
                                };
                                updateSelectedShiftInfo();
                            }
                        });
                    }, 100);
                } else {
                    loadShiftOptions(categorySelect.value, staffId);
                }
            } else {
                loadShiftOptions(categorySelect.value, null);
            }
            
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
        }

        function closeShiftModal() {
            const modal = document.getElementById('shiftModal');
            modal.style.display = 'none';
            document.body.classList.remove('modal-open');
        }

        function loadShiftOptions(category, staffId) {
            const optionsContainer = document.getElementById('shiftOptionsContainer');
            const staffSelect = document.getElementById('shiftStaffSelect');
            
            if (!category) {
                optionsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.6);">Pilih kategori shift terlebih dahulu</div>';
                return;
            }
            
            const shifts = shiftTemplates[category] || [];
            const staff = staffData.find(s => s.id == staffId || staffSelect.value);
            
            optionsContainer.innerHTML = '';
            
            if (shifts.length === 0) {
                optionsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.6);">Tidak ada shift untuk kategori ini</div>';
                return;
            }
            
            shifts.forEach(shift => {
                const option = document.createElement('div');
                option.className = 'shift-option';
                option.dataset.shiftId = shift.id;
                option.dataset.shiftName = shift.name;
                option.dataset.shiftCategory = category;
                option.dataset.shiftType = shift.category;
                option.dataset.shiftTime = shift.time;
                
                option.innerHTML = `
                    <div class="shift-option-title">${shift.name}</div>
                    <div class="shift-option-time">${shift.time}</div>
                    <span class="shift-option-category" style="background: ${shift.category === 'Senior' ? 'rgba(255,107,0,0.2)' : shift.category === 'Masa Training' ? 'rgba(0,168,255,0.2)' : shift.category.includes('Kapten') ? 'rgba(255,211,42,0.2)' : 'rgba(160,160,160,0.2)'}; color: ${shift.category === 'Senior' ? '#ff6b00' : shift.category === 'Masa Training' ? '#00a8ff' : shift.category.includes('Kapten') ? '#ffd32a' : '#a0a0a0'};">${shift.category}</span>
                `;
                
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.shift-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    
                    // Store selected shift
                    selectedShiftOption = {
                        id: shift.id,
                        name: shift.name,
                        category: category,
                        type: shift.category,
                        time: shift.time,
                        description: shift.description
                    };
                    
                    updateSelectedShiftInfo();
                });
                
                optionsContainer.appendChild(option);
            });
        }

        function updateSelectedShiftInfo() {
            if (selectedShiftOption) {
                const infoContainer = document.getElementById('selectedShiftDetails');
                infoContainer.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span class="shift-badge shift-${selectedShiftOption.category.toLowerCase()}">${selectedShiftOption.category}</span>
                        <span class="shift-category ${selectedShiftOption.type === 'Senior' ? 'senior' : selectedShiftOption.type === 'Masa Training' ? 'training' : 'kapten'}">${selectedShiftOption.type}</span>
                    </div>
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">${selectedShiftOption.name}</div>
                    <div style="font-size: 14px; color: rgba(255,255,255,0.7);">${selectedShiftOption.time}</div>
                `;
                document.getElementById('selectedShiftInfo').style.display = 'block';
            }
        }

        function saveShift() {
            const staffId = parseInt(document.getElementById('shiftStaffSelect').value);
            const category = document.getElementById('shiftCategorySelect').value;
            
            if (!staffId) {
                showNotification('Pilih staff terlebih dahulu', 'error');
                return;
            }
            
            if (!category) {
                showNotification('Pilih kategori shift terlebih dahulu', 'error');
                return;
            }
            
            if (!selectedShiftOption) {
                showNotification('Pilih shift terlebih dahulu', 'error');
                return;
            }
            
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) {
                showNotification('Staff tidak ditemukan', 'error');
                return;
            }
            
            // Update staff shift
            staff.shift = category;
            
            // Save shift data
            shiftData[staffId] = {
                staffId: staffId,
                staffName: staff.name,
                shiftName: selectedShiftOption.name,
                shiftCategory: category,
                shiftType: selectedShiftOption.type,
                shiftTime: selectedShiftOption.time
            };
            
            // Update UI
            updateStats();
            updateShiftStats();
            renderAllTables();
            saveToLocalStorage();
            
            showNotification(`Shift berhasil diatur untuk ${staff.name}`, 'success');
            closeShiftModal();
        }

        function removeShift() {
            const staffId = parseInt(document.getElementById('shiftStaffSelect').value);
            
            if (!staffId) {
                showNotification('Pilih staff terlebih dahulu', 'error');
                return;
            }
            
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) {
                showNotification('Staff tidak ditemukan', 'error');
                return;
            }
            
            if (confirm(`Hapus shift untuk ${staff.name}?`)) {
                // Remove shift from staff
                staff.shift = '';
                
                // Remove shift data
                delete shiftData[staffId];
                
                // Update UI
                updateStats();
                updateShiftStats();
                renderAllTables();
                saveToLocalStorage();
                
                showNotification(`Shift berhasil dihapus untuk ${staff.name}`, 'success');
                closeShiftModal();
            }
        }

        function assignAllShifts() {
            if (confirm('Atur shift otomatis untuk semua staff? Shift akan diatur berdasarkan role secara acak.')) {
                let assigned = 0;
                
                staffData.forEach(staff => {
                    // Skip if already has shift
                    if (staff.shift && shiftData[staff.id]) return;
                    
                    // Determine shift based on role and ID
                    let shiftCategory = '';
                    let shiftType = '';
                    
                    if (staff.role === 'Kapten') {
                        shiftCategory = ['Pagi', 'Sore', 'Malam'][staff.id % 3];
                        shiftType = staff.id % 2 === 0 ? 'Kapten 1' : 'Kapten 2';
                    } else if (staff.role === 'Kasir') {
                        shiftCategory = ['Pagi', 'Siang'][staff.id % 2];
                        shiftType = 'Senior';
                    } else {
                        shiftCategory = ['Pagi', 'Siang', 'Sore', 'Malam'][staff.id % 4];
                        shiftType = staff.id % 3 === 0 ? 'Masa Training' : 'Senior';
                    }
                    
                    // Get random shift template for the category
                    const shifts = shiftTemplates[shiftCategory];
                    if (!shifts || shifts.length === 0) return;
                    
                    // Find shift template matching the type
                    let shiftTemplate = shifts.find(s => s.category === shiftType);
                    if (!shiftTemplate && shifts.length > 0) {
                        shiftTemplate = shifts[0];
                    }
                    
                    if (shiftTemplate) {
                        staff.shift = shiftCategory;
                        shiftData[staff.id] = {
                            staffId: staff.id,
                            staffName: staff.name,
                            shiftName: shiftTemplate.name,
                            shiftCategory: shiftCategory,
                            shiftType: shiftTemplate.category,
                            shiftTime: shiftTemplate.time
                        };
                        assigned++;
                    }
                });
                
                updateStats();
                updateShiftStats();
                renderAllTables();
                saveToLocalStorage();
                
                showNotification(`${assigned} staff berhasil diberi shift`, 'success');
            }
        }

        function printShiftSchedule() {
            const printWindow = window.open('', '_blank');
            const now = new Date();
            
            let shiftScheduleHTML = `
                <html>
                <head>
                    <title>Jadwal Shift PROTEGEL</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; text-align: center; margin-bottom: 30px; }
                        .header { margin-bottom: 30px; text-align: center; }
                        .shift-section { margin-bottom: 40px; }
                        .shift-title { background: #f4f4f4; padding: 10px; font-weight: bold; margin-bottom: 10px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                        th { background-color: #f9f9f9; }
                        .footer { margin-top: 30px; font-size: 12px; color: #666; text-align: center; }
                        .pagi { background-color: #fff3cd; }
                        .siang { background-color: #d1e7dd; }
                        .sore { background-color: #f8d7da; }
                        .malam { background-color: #cfe2ff; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>JADWAL SHIFT STAFF PROTEGEL</h1>
                        <p>Tanggal: ${now.toLocaleDateString('id-ID')} | Dicetak: ${now.toLocaleTimeString('id-ID')}</p>
                    </div>
            `;
            
            // Group by shift
            const shiftGroups = {
                'Pagi': [],
                'Siang': [],
                'Sore': [],
                'Malam': [],
                'Cuti': []
            };
            
            staffData.forEach(staff => {
                if (staff.shift && shiftGroups[staff.shift]) {
                    shiftGroups[staff.shift].push(staff);
                }
            });
            
            for (const [shiftName, staffList] of Object.entries(shiftGroups)) {
                if (staffList.length === 0) continue;
                
                shiftScheduleHTML += `
                    <div class="shift-section">
                        <div class="shift-title">SHIFT ${shiftName.toUpperCase()} (${staffList.length} Staff)</div>
                        <table class="${shiftName.toLowerCase()}">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Staff</th>
                                    <th>Role</th>
                                    <th>Shift Detail</th>
                                    <th>Waktu</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                staffList.forEach((staff, index) => {
                    const shift = shiftData[staff.id];
                    shiftScheduleHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${staff.name}</td>
                            <td>${staff.role}</td>
                            <td>${shift ? shift.shiftName : '-'}</td>
                            <td>${shift ? shift.shiftTime : '-'}</td>
                        </tr>
                    `;
                });
                
                shiftScheduleHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            shiftScheduleHTML += `
                    <div class="footer">
                        <p>Dicetak dari PROTEGEL Staff Management System v2.0</p>
                        <p>Total Staff: ${staffData.length} | Staff dengan Shift: ${Object.keys(shiftData).length}</p>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(shiftScheduleHTML);
            printWindow.document.close();
            printWindow.print();
        }

        // ============================================
        // STAFF MANAGEMENT FUNCTIONS
        // ============================================

        function markAsPresent(id) {
            const staff = staffData.find(s => s.id === id);
            if (staff && staff.status === 'Tidak Hadir') {
                staff.status = 'Belum Dicek';
                staff.time = '-';
                staff.checkedBy = '-';
                
                updateStats();
                renderAllTables();
                saveToLocalStorage();
                
                showNotification(`${staff.name} ditandai hadir`);
            }
        }

        function checkinStaff(id) {
            const staff = staffData.find(s => s.id === id);
            if (staff && (staff.status === 'Belum Dicek' || staff.status === 'Tidak Hadir')) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                
                staff.status = 'Checked';
                staff.time = timeStr;
                staff.checkedBy = 'ADMIN CHANDRA KIRANA';
                
                updateStats();
                renderAllTables();
                saveToLocalStorage();
                
                showNotification(`${staff.name} berhasil check-in`);
            }
        }

        function undoCheckin(id) {
            const staff = staffData.find(s => s.id === id);
            if (staff && staff.status === 'Checked') {
                staff.status = 'Belum Dicek';
                staff.time = '-';
                staff.checkedBy = '-';
                
                updateStats();
                renderAllTables();
                saveToLocalStorage();
                
                showNotification(`Check-in ${staff.name} dibatalkan`);
            }
        }

        function checkinAllStaff() {
            if (confirm("Check-in semua staff yang belum check-in?")) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                let count = 0;
                
                staffData.forEach(staff => {
                    if (staff.status === 'Belum Dicek') {
                        staff.status = 'Checked';
                        staff.time = timeStr;
                        staff.checkedBy = 'ADMIN CHANDRA KIRANA';
                        count++;
                    }
                });
                
                updateStats();
                renderAllTables();
                saveToLocalStorage();
                
                showNotification(`${count} staff berhasil di check-in`, 'success');
            }
        }

        function addNewStaff() {
            const name = document.getElementById('staffName').value.trim();
            const role = document.getElementById('staffRole').value;
            const shift = document.getElementById('staffShift').value;
            const email = document.getElementById('staffEmail').value.trim();
            
            if (!name) {
                showNotification('Nama staff harus diisi', 'error');
                return;
            }
            
            const newStaff = {
                id: staffData.length > 0 ? Math.max(...staffData.map(s => s.id)) + 1 : 1,
                name: name.toUpperCase(),
                role: role,
                shift: shift || '',
                status: 'Belum Dicek',
                time: '-',
                checkedBy: '-',
                email: email,
                notes: '',
                dateAdded: new Date().toISOString().split('T')[0]
            };
            
            staffData.push(newStaff);
            recentAdded.unshift(newStaff);
            if (recentAdded.length > 5) recentAdded.pop();
            
            document.getElementById('staffName').value = '';
            document.getElementById('staffEmail').value = '';
            document.getElementById('staffShift').value = '';
            
            updateStats();
            updateShiftStats();
            renderAllTables();
            saveToLocalStorage();
            
            showNotification(`Staff "${name}" berhasil ditambahkan`);
        }

        function openModal() {
            document.getElementById('editModal').style.display = 'flex';
            document.body.classList.add('modal-open');
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            document.body.classList.remove('modal-open');
        }

        function editStaff(id) {
            const staff = staffData.find(s => s.id === id);
            if (staff) {
                document.getElementById('editId').value = staff.id;
                document.getElementById('editName').value = staff.name;
                document.getElementById('editRole').value = staff.role;
                document.getElementById('editShift').value = staff.shift || '';
                document.getElementById('editStatus').value = staff.status;
                
                openModal();
            }
        }

        function saveEditStaff(e) {
            e.preventDefault();
            const id = parseInt(document.getElementById('editId').value);
            const staff = staffData.find(s => s.id === id);
            
            if (staff) {
                staff.name = document.getElementById('editName').value.toUpperCase();
                staff.role = document.getElementById('editRole').value;
                staff.shift = document.getElementById('editShift').value;
                staff.status = document.getElementById('editStatus').value;
                
                if (staff.status === 'Belum Dicek' || staff.status === 'Tidak Hadir') {
                    staff.time = '-';
                    staff.checkedBy = '-';
                }
                
                updateStats();
                updateShiftStats();
                renderAllTables();
                saveToLocalStorage();
                
                closeModal();
                showNotification(`Data ${staff.name} berhasil diperbarui`);
            }
        }

        function deleteStaff(id) {
            const staff = staffData.find(s => s.id === id);
            if (staff && confirm(`Hapus staff "${staff.name}"?`)) {
                staffData = staffData.filter(s => s.id !== id);
                recentAdded = recentAdded.filter(s => s.id !== id);
                delete shiftData[id];
                
                updateStats();
                updateShiftStats();
                renderAllTables();
                saveToLocalStorage();
                
                closeModal();
                showNotification(`Staff "${staff.name}" berhasil dihapus`);
            }
        }

        function switchPage(page) {
            document.querySelectorAll('.page-content').forEach(p => {
                p.style.display = 'none';
            });
            
            document.getElementById(`${page}Page`).style.display = 'block';
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === page) {
                    link.classList.add('active');
                }
            });
            
            if (page === 'dashboard') {
                renderDashboardTable();
            } else if (page === 'checkin') {
                renderCheckinTable();
            } else if (page === 'manage') {
                renderManageTable();
            } else if (page === 'shift') {
                renderShiftTable();
                renderShiftCards();
                updateShiftStats();
            } else if (page === 'add') {
                renderRecentTable();
                updateStorageInfo();
            }
        }

        // ============================================
        // EXPORT/IMPORT FUNCTIONS
        // ============================================

        function exportData() {
            const data = staffData.map(staff => {
                const shift = shiftData[staff.id];
                return {
                    ID: `PROT${staff.id.toString().padStart(3, '0')}`,
                    Nama: staff.name,
                    Role: staff.role,
                    Shift: staff.shift || '-',
                    'Shift Detail': shift ? shift.shiftName : '-',
                    'Shift Waktu': shift ? shift.shiftTime : '-',
                    'Shift Tipe': shift ? shift.shiftType : '-',
                    Status: staff.status,
                    'Waktu Check-in': staff.time,
                    'Diperiksa Oleh': staff.checkedBy,
                    Email: staff.email,
                    Catatan: staff.notes,
                    'Tanggal Ditambahkan': staff.dateAdded
                };
            });
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + Object.keys(data[0]).join(",") + "\n"
                + data.map(row => Object.values(row).map(v => `"${v}"`).join(",")).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `protogel_staff_data_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            
            link.click();
            document.body.removeChild(link);
            
            showNotification("Data berhasil diexport ke CSV");
        }

        function exportDataToFile() {
            try {
                const dataToExport = {
                    staffData: staffData,
                    shiftData: shiftData,
                    exportDate: new Date().toISOString(),
                    totalStaff: staffData.length,
                    totalShifts: Object.keys(shiftData).length
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `protogel_staff_backup_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification('Data berhasil diexport ke file JSON', 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('Gagal mengexport data', 'error');
            }
        }

        function exportFilteredData() {
            const search = document.getElementById('searchStaff').value.toLowerCase();
            const roleFilter = document.getElementById('filterRole').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const shiftFilter = document.getElementById('filterShift').value;

            let filtered = staffData.filter(staff => {
                if (search && !staff.name.toLowerCase().includes(search)) return false;
                if (roleFilter !== 'all' && staff.role !== roleFilter) return false;
                if (statusFilter !== 'all') {
                    if (statusFilter === 'pending' && staff.status !== 'Belum Dicek') return false;
                    if (statusFilter === 'checked' && staff.status !== 'Checked') return false;
                    if (statusFilter === 'absent' && staff.status !== 'Tidak Hadir') return false;
                }
                if (shiftFilter !== 'all' && staff.shift !== shiftFilter) return false;
                return true;
            });
            
            const data = filtered.map(staff => {
                const shift = shiftData[staff.id];
                return {
                    ID: `PROT${staff.id.toString().padStart(3, '0')}`,
                    Nama: staff.name,
                    Role: staff.role,
                    Shift: staff.shift || '-',
                    'Shift Detail': shift ? shift.shiftName : '-',
                    'Shift Waktu': shift ? shift.shiftTime : '-',
                    Status: staff.status,
                    'Waktu Check-in': staff.time,
                    'Diperiksa Oleh': staff.checkedBy
                };
            });
            
            if (data.length === 0) {
                showNotification('Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + Object.keys(data[0]).join(",") + "\n"
                + data.map(row => Object.values(row).map(v => `"${v}"`).join(",")).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `protogel_staff_filtered_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            
            link.click();
            document.body.removeChild(link);
            
            showNotification(`Berhasil export ${data.length} data staff`, 'success');
        }

        function importDataFromFile() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (importedData.staffData && Array.isArray(importedData.staffData)) {
                            if (confirm(`Import ${importedData.staffData.length} staff dari file?`)) {
                                staffData = importedData.staffData;
                                recentAdded = importedData.recentAdded || [];
                                shiftData = importedData.shiftData || {};
                                
                                saveToLocalStorage();
                                updateStats();
                                updateShiftStats();
                                renderAllTables();
                                
                                showNotification(`Berhasil mengimport ${staffData.length} staff`, 'success');
                            }
                        } else {
                            showNotification('Format file tidak valid', 'error');
                        }
                    } catch (error) {
                        console.error('Error importing data:', error);
                        showNotification('Gagal mengimport data', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            fileInput.click();
        }

        function printReport() {
            const printWindow = window.open('', '_blank');
            const now = new Date();
            
            let reportHTML = `
                <html>
                    <head>
                        <title>Laporan Staff PROTEGEL</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #333; text-align: center; margin-bottom: 30px; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f4f4f4; }
                            .header { text-align: center; margin-bottom: 30px; }
                            .footer { margin-top: 30px; font-size: 12px; color: #666; }
                            .stats { display: flex; justify-content: space-around; margin: 20px 0; }
                            .stat-box { text-align: center; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>LAPORAN STAFF PROTEGEL</h1>
                            <p>Tanggal: ${now.toLocaleDateString('id-ID')}</p>
                            <div class="stats">
                                <div class="stat-box">
                                    <h3>Total Staff</h3>
                                    <p>${staffData.length}</p>
                                </div>
                                <div class="stat-box">
                                    <h3>Sudah Check-in</h3>
                                    <p>${staffData.filter(s => s.status === 'Checked').length}</p>
                                </div>
                                <div class="stat-box">
                                    <h3>Belum Check-in</h3>
                                    <p>${staffData.filter(s => s.status === 'Belum Dicek').length}</p>
                                </div>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Staff</th>
                                    <th>Role</th>
                                    <th>Shift</th>
                                    <th>Status</th>
                                    <th>Waktu Check-in</th>
                                    <th>Diperiksa Oleh</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${staffData.map(staff => {
                                    const shift = shiftData[staff.id];
                                    return `
                                        <tr>
                                            <td>${staff.name}</td>
                                            <td>${staff.role}</td>
                                            <td>${shift ? shift.shiftName : '-'}</td>
                                            <td>${staff.status}</td>
                                            <td>${staff.time}</td>
                                            <td>${staff.checkedBy}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                        <div class="footer">
                            <p>Dicetak dari PROTEGEL Staff Management System</p>
                            <p>${now.toLocaleString('id-ID')}</p>
                        </div>
                    </body>
                </html>
            `;
            
            printWindow.document.write(reportHTML);
            printWindow.document.close();
            printWindow.print();
        }

        // ============================================
        // EVENT LISTENERS INITIALIZATION
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data
            initializeData();
            
            // Set up clock
            updateClock();
            setInterval(updateClock, 1000);
            
            // Render initial tables
            renderAllTables();
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    switchPage(this.dataset.page);
                });
            });
            
            // Button event listeners
            document.getElementById('checkinAllBtn').addEventListener('click', checkinAllStaff);
            document.getElementById('quickCheckinBtn').addEventListener('click', checkinAllStaff);
            document.getElementById('saveStaffBtn').addEventListener('click', addNewStaff);
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('exportLocalBtn').addEventListener('click', exportDataToFile);
            document.getElementById('exportFilteredBtn').addEventListener('click', exportFilteredData);
            document.getElementById('printReportBtn').addEventListener('click', printReport);
            document.getElementById('printShiftBtn').addEventListener('click', printShiftSchedule);
            document.getElementById('importDataBtn').addEventListener('click', importDataFromFile);
            document.getElementById('resetAllBtn').addEventListener('click', openResetModal);
            
            // Shift buttons
            document.getElementById('assignAllShiftsBtn').addEventListener('click', assignAllShifts);
            document.getElementById('resetShiftBtn').addEventListener('click', function() {
                if (confirm('Reset semua shift ke kondisi awal? Semua shift yang sudah diatur akan dihapus.')) {
                    resetShiftData();
                }
            });
            document.getElementById('newShiftBtn').addEventListener('click', function() {
                openShiftModal(null);
            });
            document.getElementById('goToShiftBtn').addEventListener('click', function() {
                switchPage('shift');
            });
            document.getElementById('goToShiftBtn2').addEventListener('click', function() {
                switchPage('shift');
            });
            
            // Modal buttons
            document.getElementById('saveShiftBtn').addEventListener('click', saveShift);
            document.getElementById('removeShiftBtn').addEventListener('click', removeShift);
            document.getElementById('closeShiftModalBtn').addEventListener('click', closeShiftModal);
            document.getElementById('saveEditBtn').addEventListener('click', saveEditStaff);
            document.getElementById('editShiftBtn').addEventListener('click', function() {
                const id = parseInt(document.getElementById('editId').value);
                closeModal();
                openShiftModal(id);
            });
            document.getElementById('deleteStaffBtn').addEventListener('click', function() {
                const id = parseInt(document.getElementById('editId').value);
                deleteStaff(id);
            });
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            
            // Reset modal buttons
            document.getElementById('closeResetModalBtn').addEventListener('click', closeResetModal);
            
            // Reset option selection
            document.querySelectorAll('.reset-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    document.querySelectorAll('.reset-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Show confirmation
                    const resetType = this.dataset.type;
                    const confirmationDiv = document.getElementById('resetConfirmation');
                    const confirmationText = document.getElementById('confirmationText');
                    
                    let actionText = '';
                    let affectedItems = '';
                    
                    switch(resetType) {
                        case 'shift':
                            actionText = 'Reset semua shift';
                            affectedItems = `${Object.keys(shiftData).length} staff yang memiliki shift akan direset`;
                            break;
                        case 'checkin':
                            const checkedInCount = staffData.filter(s => s.status === 'Checked').length;
                            const absentCount = staffData.filter(s => s.status === 'Tidak Hadir').length;
                            actionText = 'Reset semua check-in';
                            affectedItems = `${checkedInCount + absentCount} staff yang sudah check-in/tidak hadir akan direset`;
                            break;
                        case 'all':
                            actionText = 'Reset semua data';
                            affectedItems = `Semua shift (${Object.keys(shiftData).length}) dan check-in akan direset`;
                            break;
                    }
                    
                    confirmationText.textContent = `Anda yakin ingin ${actionText.toLowerCase()}? ${affectedItems}.`;
                    confirmationDiv.style.display = 'block';
                    
                    // Update confirm button
                    const confirmBtn = document.getElementById('confirmResetBtn');
                    confirmBtn.onclick = function() {
                        switch(resetType) {
                            case 'shift':
                                resetShiftData();
                                break;
                            case 'checkin':
                                resetCheckinData();
                                break;
                            case 'all':
                                resetAllData();
                                break;
                        }
                        closeResetModal();
                    };
                });
            });
            
            document.getElementById('cancelResetBtn').addEventListener('click', function() {
                document.getElementById('resetConfirmation').style.display = 'none';
                document.querySelectorAll('.reset-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
            });
            
            // Shift modal dropdown changes
            document.getElementById('shiftCategorySelect').addEventListener('change', function() {
                const staffId = document.getElementById('shiftStaffSelect').value;
                loadShiftOptions(this.value, staffId);
            });
            
            document.getElementById('shiftStaffSelect').addEventListener('change', function() {
                const category = document.getElementById('shiftCategorySelect').value;
                loadShiftOptions(category, this.value);
            });
            
            // Filter event listeners
            document.getElementById('searchStaff').addEventListener('input', renderCheckinTable);
            document.getElementById('filterRole').addEventListener('change', renderCheckinTable);
            document.getElementById('filterStatus').addEventListener('change', renderCheckinTable);
            document.getElementById('filterShift').addEventListener('change', renderCheckinTable);
            document.getElementById('searchManage').addEventListener('input', renderManageTable);
            document.getElementById('filterManageRole').addEventListener('change', renderManageTable);
            document.getElementById('searchShift').addEventListener('input', renderShiftTable);
            document.getElementById('filterShiftCategory').addEventListener('change', renderShiftTable);
            document.getElementById('filterShiftType').addEventListener('change', renderShiftTable);
            
            document.getElementById('addStaffBtn').addEventListener('click', function() {
                switchPage('add');
            });
            
            document.getElementById('refreshDashboard').addEventListener('click', function() {
                renderAllTables();
                updateStorageInfo();
                showNotification('Dashboard diperbarui');
            });
            
            document.getElementById('exportReportBtn').addEventListener('click', function() {
                exportData();
            });
            
            document.getElementById('staffName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNewStaff();
                }
            });

            // Close modals when clicking outside
            document.getElementById('editModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            document.getElementById('shiftModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeShiftModal();
                }
            });
            
            document.getElementById('resetModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeResetModal();
                }
            });
            
            // Escape key to close modals
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (document.getElementById('editModal').style.display === 'flex') {
                        closeModal();
                    }
                    if (document.getElementById('shiftModal').style.display === 'flex') {
                        closeShiftModal();
                    }
                    if (document.getElementById('resetModal').style.display === 'flex') {
                        closeResetModal();
                    }
                }
            });

            // Auto-save
            window.addEventListener('beforeunload', saveToLocalStorage);
            setInterval(saveToLocalStorage, 30000);

            console.log('PROTEGEL Staff System v2.0 with Reset Functionality initialized');
        });
    </script>
</body>
</html>